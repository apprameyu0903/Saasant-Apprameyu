package com.dao;
import java.util.*;
import com.util.DBUtil;
import com.vo.CustomerDetails;

import java.sql.*;

public class CustomerDao implements{

    public boolean addCustomer(CustomerDetails customer) {
        String sql = "insert into customers (customer_id, customer_name, customer_mobile, customer_location) values (?, ?, ?, ?)";

        try (Connection conn = DBUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {

            if (getCustomerById(customer.getCustomerId()) != null) {
                System.out.println("❗ Customer ID already exists.");
                return false;
            }

            stmt.setString(1, customer.getCustomerId());
            stmt.setString(2, customer.getCustomerName());
            stmt.setString(3, customer.getMobileNumber());
            stmt.setString(4, customer.getCustomerLocation());

            int rows = stmt.executeUpdate();
            return rows > 0;

        } catch (SQLException e) {
            e.printStackTrace();
            System.out.println("Error in the DB Connectivity");
        }
        return false;
    }

    public CustomerDetails getCustomerById(String customerId) {
        String sql = "SELECT * FROM customers WHERE customer_id = ?";

        try (Connection conn = DBUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {

            stmt.setString(1, customerId);
            ResultSet rs = stmt.executeQuery();

            if (rs.next()) {
                String name = rs.getString("customer_name");
                String mobile = rs.getString("customer_mobile");
                String location = rs.getString("customer_location");
                return new CustomerDetails(customerId, name, mobile, location);
            }

        } catch (SQLException e) {
            e.printStackTrace();
            System.out.println("Error in the DB Connectivity");
        }
        return null;
    }
    
    public boolean updateCustomer(CustomerDetails customer) {
        String sql = "UPDATE customers SET customer_name = ?, customer_mobile = ?, customer_location = ? WHERE customer_id = ?";

        try (Connection conn = DBUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {

            stmt.setString(1, customer.getCustomerName());
            stmt.setString(2, customer.getMobileNumber());
            stmt.setString(3, customer.getCustomerLocation());
            stmt.setString(4, customer.getCustomerId());
            

            int rows = stmt.executeUpdate();
            return rows > 0;

        } catch (SQLException e) {
            e.printStackTrace();
            System.out.println("Error in the DB Connectivity");
        }
        return false;
    }
    
    public boolean deleteCustomer(String customerId) {
        String sql = "DELETE FROM customers WHERE customer_id = ?";

        try (Connection conn = DBUtil.getConnection();
             PreparedStatement stmt = conn.prepareStatement(sql)) {

            stmt.setString(1, customerId);
            int rows = stmt.executeUpdate();
            return rows > 0;

        } catch (SQLException e) {
            e.printStackTrace();
            System.out.println("Error in the DB Connectivity");
        }
        return false;
    }
    
    public List<CustomerDetails> getAllCustomers() {
        List<CustomerDetails> customers = new ArrayList<>();
        String sql = "SELECT * FROM customers";

        try (Connection conn = DBUtil.getConnection();
             Statement stmt = conn.createStatement();
             ResultSet rs = stmt.executeQuery(sql)) {

            while (rs.next()) {
                String id = rs.getString("customer_id");
                String name = rs.getString("customer_name");
                String mobile = rs.getString("customer_mobile");
                String location = rs.getString("customer_location");
                customers.add(new CustomerDetails(id, name, mobile, location));
            }

        } catch (SQLException e) {
            e.printStackTrace();
            System.out.println("Error in the DB Connectivity");
        }
        return customers;
    }

}
